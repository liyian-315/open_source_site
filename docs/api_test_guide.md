# 登录功能接口测试指南

本文档提供了如何使用Apifox测试登录和注册接口的详细说明。

## 接口概述

系统提供了两个主要的认证接口：

1. **用户注册**: `/api/auth/register`
2. **用户登录**: `/api/auth/login`

## 环境准备

1. 确保项目已正确启动，默认端口为8080
2. 确保数据库已初始化，包含用户表
3. 下载并安装Apifox客户端：[https://www.apifox.cn/](https://www.apifox.cn/)

## 在Apifox中创建项目

1. 打开Apifox客户端
2. 点击「新建项目」
3. 填写项目名称，如「开源站点项目」
4. 设置基础URL为：`http://localhost:8080`

## 配置接口

### 1. 用户注册接口

1. 在Apifox中点击「新建接口」
2. 填写基本信息：
   - 接口名称：用户注册
   - 接口路径：`/api/auth/register`
   - 请求方法：POST

3. 配置请求参数：
   - 选择「Body」标签页
   - 选择「JSON」格式
   - 输入请求体示例：

```json
{
  "username": "testuser",
  "password": "123456",
  "email": "test@example.com"
}
```

4. 配置响应示例：
   - 点击「新增响应示例」
   - 名称：成功响应
   - 状态码：200
   - 响应体：

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "id": 3,
    "username": "testuser",
    "email": "test@example.com",
    "role": "USER"
  }
}
```

### 2. 用户登录接口

1. 在Apifox中点击「新建接口」
2. 填写基本信息：
   - 接口名称：用户登录
   - 接口路径：`/api/auth/login`
   - 请求方法：POST

3. 配置请求参数：
   - 选择「Body」标签页
   - 选择「JSON」格式
   - 输入请求体示例：

```json
{
  "username": "user",
  "password": "123456"
}
```

4. 配置响应示例：
   - 点击「新增响应示例」
   - 名称：成功响应
   - 状态码：200
   - 响应体：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "token": "eyJhbGciOiJIUzUxMiJ9...",
    "username": "testuser",
    "role": "USER"
  }
}
```

## 测试流程

### 1. 测试注册接口

1. 选择「用户注册」接口
2. 点击「发送」按钮
3. 检查响应状态码是否为200
4. 检查响应体中的message是否为「注册成功」
5. 检查data中是否包含用户信息

### 2. 测试登录接口

1. 选择「用户登录」接口
2. 点击「发送」按钮
3. 检查响应状态码是否为200
4. 检查响应体中是否包含token字段
5. 保存token值，用于后续接口的认证

## 使用JWT进行认证

获取到登录接口返回的token后，可以使用该token访问需要认证的接口：

1. 在Apifox中创建新的接口
2. 在「请求头」标签页中添加：
   - 名称：Authorization
   - 值：Bearer {token}
   （将{token}替换为实际的token值）

## 常见问题

1. **注册失败，提示「用户名已存在」**
   - 尝试使用不同的用户名

2. **登录失败，提示「无效的凭据」**
   - 检查用户名和密码是否正确
   - 确认用户是否已注册

3. **访问受保护接口失败，返回401**
   - 检查Authorization头是否正确设置
   - 检查token是否已过期（默认有效期为24小时）
   - 确保token前缀为"Bearer "（注意空格）

## 测试用例

### 注册测试用例

1. **正常注册**
   - 输入有效的用户名、密码和邮箱
   - 预期结果：返回200，注册成功

2. **重复用户名**
   - 输入已存在的用户名
   - 预期结果：返回400，用户名已存在

3. **无效输入**
   - 不提供必要字段（如用户名或密码）
   - 预期结果：返回400，参数错误

### 登录测试用例

1. **正常登录**
   - 输入正确的用户名和密码
   - 预期结果：返回200，包含token

2. **错误凭据**
   - 输入错误的密码
   - 预期结果：返回400，无效的凭据

3. **用户不存在**
   - 输入不存在的用户名
   - 预期结果：返回400，无效的凭据